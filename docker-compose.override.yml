x-common: &common
  build:
    context: .
    dockerfile: dockerfile
  environment:
    - LOG_LEVEL=INFO
  volumes:
    - gtfs_data:/app/data
    - gtfs_logs:/app/logs
  restart: unless-stopped
  deploy:
    resources:
      limits:
        cpus: "0.5"
        memory: 256M
      reservations:
        cpus: "0.1"
        memory: 128M
  healthcheck:
    test: ["CMD", "test", "-d", "/app/data"]
    interval: 30s
    timeout: 10s
    retries: 3
    start_period: 10s
  logging:
    driver: "json-file"
    options:
      max-size: "10m"
      max-file: "3"
  stop_grace_period: 30s

services:
  caltrain:
    <<: *common
    container_name: gtfspb-caltrain
    env_file: envs/.env.caltrain

  cats_charlotte_nc:
    <<: *common
    container_name: gtfspb-cats_charlotte_nc
    env_file: envs/.env.cats_charlotte_nc

  ct_transit:
    <<: *common
    container_name: gtfspb-ct_transit
    env_file: envs/.env.ct_transit

  denver_rtd:
    <<: *common
    container_name: gtfspb-denver_rtd
    env_file: envs/.env.denver_rtd

  king_county_metro:
    <<: *common
    container_name: gtfspb-king_county_metro
    env_file: envs/.env.king_county_metro

  marta_bus:
    <<: *common
    container_name: gtfspb-marta_bus
    env_file: envs/.env.marta_bus

  mbta:
    <<: *common
    container_name: gtfspb-mbta
    env_file: envs/.env.mbta

  nashvillemta:
    <<: *common
    container_name: gtfspb-nashvillemta
    env_file: envs/.env.nashvillemta

  pvta:
    <<: *common
    container_name: gtfspb-pvta
    env_file: envs/.env.pvta

  ripta:
    <<: *common
    container_name: gtfspb-ripta
    env_file: envs/.env.ripta

  septa_bus:
    <<: *common
    container_name: gtfspb-septa_bus
    env_file: envs/.env.septa_bus

  septa_rail:
    <<: *common
    container_name: gtfspb-septa_rail
    env_file: envs/.env.septa_rail

  toronto_ttc:
    <<: *common
    container_name: gtfspb-toronto_ttc
    env_file: envs/.env.toronto_ttc

  wmata_bus:
    <<: *common
    container_name: gtfspb-wmata_bus
    env_file: envs/.env.wmata_bus

  wmata_rail:
    <<: *common
    container_name: gtfspb-wmata_rail
    env_file: envs/.env.wmata_rail

networks:
  default:
    name: gtfs-network

volumes:
  gtfs_data:
    driver: local
  gtfs_logs:
    driver: local
